<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Video Downloader Pro - TikTok & YouTube</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI, Tahoma, Arial, sans-serif}
body{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#222;padding:20px}
.container{max-width:1100px;margin:0 auto}
header{text-align:center;color:#fff;padding:26px 0}
.header-sub{opacity:.95;margin-top:6px}
.main-content{display:flex;gap:30px;flex-wrap:wrap;margin-bottom:30px}
.card{background:#fff;border-radius:14px;padding:26px;box-shadow:0 15px 30px rgba(0,0,0,.12);flex:1;min-width:300px}
.section-title{display:flex;align-items:center;gap:10px;font-size:1.5rem;color:#4a5568;margin-bottom:14px}
.platforms{display:flex;gap:10px;margin-bottom:14px}
.platform-btn{flex:1;padding:10px;border-radius:8px;border:2px solid #e6edf8;background:#f7fafc;cursor:pointer;font-weight:600;display:flex;align-items:center;justify-content:center;gap:8px}
.platform-btn.active{background:#667eea;color:#fff;border-color:#667eea}
.url-input{width:100%;padding:12px;border-radius:10px;border:2px solid #e6edf8;font-size:1rem}
.download-btn{width:100%;padding:12px;margin-top:12px;border-radius:10px;border:none;background:linear-gradient(90deg,#667eea,#764ba2);color:#fff;font-weight:700;cursor:pointer}
.alert{display:none;padding:12px;border-radius:8px;margin-top:12px}
.alert.error{background:#f8d7da;color:#7a1f2d}
.alert.success{background:#d4edda;color:#14532d}
.loading{display:none;text-align:center;margin-top:12px;color:#fff}
.loader-keren{width:64px;height:64px;border-radius:50%;position:relative;margin:0 auto 8px}
.loader-keren:before,.loader-keren:after{content:'';position:absolute;inset:0;border-radius:50%;border:4px solid rgba(255,255,255,0.8);animation:pulse 1.4s infinite}
.loader-keren:after{animation-delay:.7s}
@keyframes pulse{0%{transform:scale(.6);opacity:1}100%{transform:scale(1.6);opacity:0}}
.result{display:none;background:#fff;border-radius:14px;padding:22px;box-shadow:0 12px 24px rgba(0,0,0,.1);margin-top:20px}
.video-thumb{max-width:320px;border-radius:10px;display:block;margin:0 auto 12px}
.formats{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px}
.format-btn{background:#f7fafc;border:2px solid #e6edf8;padding:12px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
.footer{color:#fff;text-align:center;margin-top:18px;opacity:.9}
@media(max-width:768px){.main-content{flex-direction:column}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div style="font-size:42px"><i class="fas fa-video"></i> <i class="fas fa-download"></i></div>
    <h1>Video Downloader Pro</h1>
    <div class="header-sub">Download TikTok & YouTube tanpa watermark — cepat & gratis.</div>
  </header>

  <div class="main-content">
    <div class="card">
      <div class="section-title"><i class="fas fa-download"></i> Download Video</div>

      <div class="platforms" id="platforms">
        <div class="platform-btn active" data-platform="tiktok"><i class="fab fa-tiktok"></i> TikTok</div>
        <div class="platform-btn" data-platform="youtube"><i class="fab fa-youtube"></i> YouTube</div>
      </div>

      <label for="videoUrl">Masukkan Link Video:</label>
      <input id="videoUrl" class="url-input" placeholder="https://www.tiktok.com/@user/video/... or https://www.youtube.com/watch?v=..." />

      <button id="processBtn" class="download-btn"><i class="fas fa-cogs"></i> Proses Video</button>

      <div id="errorAlert" class="alert error"></div>
      <div id="successAlert" class="alert success"></div>

      <div id="loading" class="loading">
        <div class="loader-keren"></div>
        <div>Memproses...</div>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><i class="fas fa-info-circle"></i> Informasi</div>
      <div style="color:#4a5568">
        <p>Gunakan dengan bijak. Masukkan link TikTok atau YouTube. YouTube formats ditarik dari API publik.</p>
      </div>
    </div>
  </div>

  <div id="result" class="result">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="section-title"><i class="fas fa-film"></i> Hasil Video</div>
      <button id="resetBtn" class="download-btn" style="background:#888;width:auto">Download Baru</button>
    </div>

    <img id="thumb" class="video-thumb" src="" alt="thumbnail" />
    <h3 id="title"></h3>
    <p id="desc" style="color:#4a5568"></p>

    <div id="formats" class="formats"></div>
  </div>

  <div class="footer">© 2023 Video Downloader Pro</div>
</div>

<script>
(function(){
  const platforms = document.querySelectorAll('.platform-btn');
  const videoUrl = document.getElementById('videoUrl');
  const processBtn = document.getElementById('processBtn');
  const loading = document.getElementById('loading');
  const errorAlert = document.getElementById('errorAlert');
  const successAlert = document.getElementById('successAlert');
  const result = document.getElementById('result');
  const thumb = document.getElementById('thumb');
  const titleEl = document.getElementById('title');
  const descEl = document.getElementById('desc');
  const formatsEl = document.getElementById('formats');
  const resetBtn = document.getElementById('resetBtn');

  let platform = 'tiktok';

  platforms.forEach(p=>{
    p.addEventListener('click',()=>{
      platforms.forEach(x=>x.classList.remove('active'));
      p.classList.add('active');
      platform = p.dataset.platform;
      hideAlerts();
      result.style.display='none';
    });
  });

  function showError(msg){ errorAlert.style.display='block'; errorAlert.innerText = msg; }
  function showSuccess(msg){ successAlert.style.display='block'; successAlert.innerText = msg; }
  function hideAlerts(){ errorAlert.style.display='none'; successAlert.style.display='none'; }

  async function fetchTikTok(url){
    const r = await fetch('/api/tiktok?url=' + encodeURIComponent(url));
    if(!r.ok) throw new Error('TikTok API error');
    return r.json();
  }

  async function fetchYT(url){
    const r = await fetch('/api/youtube?url=' + encodeURIComponent(url));
    if(!r.ok) throw new Error('YouTube API error');
    return r.json();
  }

  function renderFormats(list){
    formatsEl.innerHTML = '';
    list.forEach(f=>{
      const div = document.createElement('div');
      div.className='format-btn';
      div.innerHTML = '<div><strong>'+ (f.quality || f.qualityLabel || 'unknown') +'</strong></div><div><i class="fas fa-download"></i></div>';
      div.addEventListener('click', ()=> window.open(f.url, '_blank'));
      formatsEl.appendChild(div);
    });
  }

  async function process(){
    hideAlerts();
    result.style.display='none';
    formatsEl.innerHTML='';
    const link = videoUrl.value.trim();
    if(!link){ showError('Masukkan link video'); return; }

    loading.style.display='block';
    try{
      if(platform==='tiktok'){
        if(!/tiktok\.com|vt\.tiktok\.com/.test(link)) throw new Error('Link TikTok tidak valid');
        const api = await fetchTikTok(link);
        // expected: description, author.nickname, cover, downloadUrl
        thumb.src = api.cover || '';
        titleEl.innerText = api.description || 'Video TikTok';
        descEl.innerText = api.author?.nickname || '';
        renderFormats([{quality:'MP4 (No Watermark)', url: api.downloadUrl}]);
      } else {
        if(!/youtu\.be|youtube\.com/.test(link)) throw new Error('Link YouTube tidak valid');
        const api = await fetchYT(link);
        // api expected to return: title, thumbnail, formats [{quality, url}]
        thumb.src = api.thumbnail || '';
        titleEl.innerText = api.title || 'YouTube Video';
        descEl.innerText = api.author || api.uploader || '';
        const fmts = api.formats && Array.isArray(api.formats) ? api.formats : (api.formats_list || []);
        if(!fmts || fmts.length===0) throw new Error('Tidak ada format tersedia');
        renderFormats(fmts);
      }
      result.style.display='block';
      showSuccess('Video berhasil diproses!');
    } catch(err){
      console.error(err);
      showError(err.message || 'Gagal memproses');
    } finally{
      loading.style.display='none';
    }
  }

  processBtn.addEventListener('click', process);
  resetBtn.addEventListener('click', ()=>{ videoUrl.value=''; result.style.display='none'; hideAlerts(); });
  videoUrl.addEventListener('keydown', e=>{ if(e.key==='Enter') process(); });

})();
</script>
</body>
</html>
